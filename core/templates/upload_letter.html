{% extends 'base.html' %}

{% block content %}
<h2>Upload Your Letter üíå</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {# üî¥ show form-wide errors (like "Please upload at least one image") #}
    {% if form.non_field_errors %}
      <div style="color:#c00; margin-bottom:10px;">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <label for="id_letter_type">Letter Type:</label><br>
    {{ form.letter_type }}
    {% if form.letter_type.errors %}
      <div style="color:#c00">{{ form.letter_type.errors|join:", " }}</div>
    {% endif %}
    <br><br>

    <div id="text_content_div" style="display:none;">
        <label for="id_text_content">Text Content:</label><br>
        {{ form.text_content }}
        {% if form.text_content.errors %}
          <div style="color:#c00">{{ form.text_content.errors|join:", " }}</div>
        {% endif %}
    </div>

    <div id="image_upload_div" style="display:none;">
        <label for="images">Upload Images:</label><br>
        <!-- ‚úÖ multiple + restrict to images -->
        <input type="file" name="images" id="id_images" multiple accept="image/*">
    </div>

    <div id="pdf_upload_div" style="display:none;">
        <label for="id_pdf">Upload PDF:</label><br>
        <!-- ‚úÖ restrict to PDF only -->
        <input type="file" name="pdf" id="id_pdf" accept=".pdf,application/pdf">
        {% if form.pdf.errors %}
          <div style="color:#c00">{{ form.pdf.errors|join:", " }}</div>
        {% endif %}
    </div>

    <br>
    <button type="submit" class="btn btn-primary">üì§ Upload Letter</button>
</form>

<br>
<a href="{% url 'view_profile' %}" class="btn btn-secondary">‚Üê Back to Profile</a>

<script>
    const letterTypeSelect = document.getElementById('id_letter_type');
    const textDiv = document.getElementById('text_content_div');
    const imageDiv = document.getElementById('image_upload_div');
    const pdfDiv = document.getElementById('pdf_upload_div');

    function toggleUploadFields() {
        const choice = letterTypeSelect.value;
        textDiv.style.display = (choice === 'text') ? 'block' : 'none';
        imageDiv.style.display = (choice === 'image') ? 'block' : 'none';
        pdfDiv.style.display = (choice === 'pdf') ? 'block' : 'none';
    }

    letterTypeSelect.addEventListener('change', toggleUploadFields);
    toggleUploadFields();  // Run once at load
</script>
{% endblock %}
