{% extends 'base.html' %}
{% block content %}

<h2>Edit Your Profile ✏️</h2>

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}

    {% if letters %}
        {% for letter in letters %}
            {% if letter.letter_type == "text" %}
                <label for="id_text_content"><strong>Letter Text Content:</strong></label><br>
                <textarea name="text_content" rows="4" style="width: 100%;">{{ letter.text_content }}</textarea>
                <input type="hidden" name="letter_id" value="{{ letter.id }}">

                <br><br>
                <a href="{% url 'delete_letter' letter.id %}" class="btn btn-sm btn-danger"
                   onclick="return confirm('Are you sure you want to delete this letter?');">
                   ❌ Delete Letter
                </a>

            {% elif letter.letter_type == "image" %}
                <label><strong>Your Letter Images:</strong></label><br>
                {% if letter.images.exists %}
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px;">
                        {% for img in letter.images.all %}
                            <div style="position: relative; display: inline-block;">
                                <img src="{{ img.image.url }}" alt="Letter Image"
                                     style="max-width: 200px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1);">
                                <a href="{% url 'delete_letter_image' img.id %}"
                                   onclick="return confirm('Delete this image?');"
                                   style="position: absolute; top: 5px; right: 5px; background: rgba(255,0,0,0.8);
                                   color: white; border-radius: 50%; padding: 3px 8px; text-decoration: none;
                                   font-weight: bold; font-size: 14px;">
                                    ×
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <a href="{% url 'add_letter_images' letter.id %}" class="btn btn-sm btn-primary">➕ Upload More Images</a>
                {% else %}
                    <a href="{% url 'upload_letter' %}" class="btn btn-sm btn-primary">➕ Upload a New Letter</a>
                {% endif %}

            {% elif letter.letter_type == "pdf" %}
                {% if letter.pdf %}
                    <p>📄 <a href="{{ letter.pdf.url }}" target="_blank">View PDF Letter</a></p>
                {% else %}
                    <p><em>No PDF uploaded yet.</em></p>
                {% endif %}

                <br>
                <a href="{% url 'delete_letter' letter.id %}" class="btn btn-sm btn-danger"
                   onclick="return confirm('Are you sure you want to delete this letter?');">
                   ❌ Delete Letter
                </a>
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if not letters %}
        <a href="{% url 'upload_letter' %}" class="btn btn-primary">➕ Upload Your  Letter</a>
        <br><br>
    {% endif %}

    <button type="submit" class="btn btn-success">💾 Save Changes</button>
</form>

<br>
<a href="{% url 'view_profile' %}" class="btn btn-secondary">← Back to Profile</a>

{% endblock %}
